<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode | default "en" }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

    <!-- FOUC Prevention: Apply theme before first paint -->
    <script>
        (function() {
            const storageKey = 'lykeion-theme';
            const stored = localStorage.getItem(storageKey);
            let theme;

            if (stored === 'light' || stored === 'dark') {
                theme = stored;
            } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                theme = 'dark';
            } else {
                theme = 'light';
            }

            document.documentElement.style.colorScheme = theme;
        })();
    </script>

    <link rel="manifest" href="{{ "manifest.json" | relURL }}">

    <link rel="stylesheet" href="{{ "css/utils/fonts.css" | relURL }}">
    <link rel="stylesheet" href="{{ "css/base/reset.css" | relURL }}">
    <link rel="stylesheet" href="{{ "css/base/layout.css" | relURL }}">
    <link rel="stylesheet" href="{{ "css/base/typography.css" | relURL }}">

    <!-- PWA / Mobile App Configuration -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>
    {{ if .Description }}
        <meta name="description" content="{{ .Description }}">
    {{ else if .Site.Params.description }}
        <meta name="description" content="{{ .Site.Params.description }}">
    {{ end }}

    {{ if .Param "math" }}
        {{ partialCached "math.html" . }}
    {{ end }}
    {{ block "head" . }}{{ end }}

    <!-- Theme Manager -->
    <script type="module" src="{{ "js/theme.js" | relURL }}" defer></script>
</head>
<body>
    <div class="main-wrapper">

        {{ block "main" . }}{{ end }}

    </div>
</body>
</html>